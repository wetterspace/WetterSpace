function drawDashboard(e){var t=e[0].element;t=t.replace(/ae/g,"ä").replace(/oe/g,"ö").replace(/ue/g,"ü");var a=e[0].einheit,r=getDataArray(e),n=createDashboardAndGetId(t),o=t+"_chart",d=t+"_slider";chartsDataTables[o]=[],chartsDataTables[o]=[e],addDivForChart(o,n),addDivForSlider(d,n),addDeleteChartButton(n),drawGoogleDashboard(r,a,n,d,o,t)}function drawGoogleDashboard(e,t,a,r,n,o){var d=new google.visualization.DataTable;d.addColumn("date","X"),d.addColumn("number",t),d.addRows(e);var i=new google.visualization.Dashboard(document.getElementById(a)),l=new google.visualization.ControlWrapper({controlType:"ChartRangeFilter",containerId:r,options:{filterColumnIndex:0,ui:{chartOptions:{height:50}}}}),c=new google.visualization.ChartWrapper({chartType:"LineChart",containerId:n,options:{titleTextStyle:{fontSize:18},title:o,hAxis:{title:"Datum"}}});i.bind(l,c),i.draw(d)}function getDataArray(e){var t=[];for(i=0;i<e.length;i++){var a=e[i].date;a=convertToDate(a);var r=e[i].wert;r=parseFloat(r.replace(",",".")),t[i]=[],t[i][0]=a,t[i][1]=r}return t}function convertToDate(e){var t=e.split("-"),a=t[0],r=t[1],n=t[2];return new Date(a,r,n)}function createDashboardAndGetId(e){var t=e+"_dashboard";if(!document.getElementById(t)){var a=document.createElement("div"),r=document.getElementById("charts");a.setAttribute("class","dashboardDivArea"),a.setAttribute("id",t),r.appendChild(a)}return t}function addDivForChart(e,t){if(!document.getElementById(e)){var a=document.createElement("div"),r=document.getElementById(t);a.setAttribute("id",e),a.setAttribute("draggable","true"),a.setAttribute("ondragstart","dragStart(event)"),a.setAttribute("ondrop","dragDrop(event)"),a.setAttribute("ondragover","allowDrop(event)"),r.appendChild(a)}}function addDivForSlider(e,t){if(!document.getElementById(e)){var a=document.createElement("div"),r=document.getElementById(t);a.setAttribute("id",e),r.appendChild(a)}}function dragStart(e){e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("Text",e.target.getAttribute("id"))}function dragDrop(e){var t=e.dataTransfer.getData("Text"),a=e.currentTarget.getAttribute("id");createOverlayChart(t,a)}function allowDrop(e){e.preventDefault()}function createOverlayChart(e,t){var a=chartsDataTables[e],r=chartsDataTables[t],n=a.concat(r),o=t.replace(/_chart/g,"").replace(/_overlay/g,""),d=(e+" "+t).replace(/_chart/g,"").replace(/_overlay/g,""),i=getOverlayDataArray(n),l=document.getElementById(t),c=document.getElementById(o+"_slider");null==c&&(c=document.getElementById(o+"_slider_overlay"));var u=l.parentNode;uncheckButtons(o),u.setAttribute("id",d+"_dashboard_overlay"),c.setAttribute("id",d+"_slider_overlay"),l.setAttribute("id",d+"_chart_overlay");var s=new google.visualization.DataTable;s.addColumn("date","X");for(var h=0,g=[],v="",m=0;m<n.length;m++)-1==g.indexOf(n[m][0].element)&&(v+=n[m][0].element+" / ",g.push(n[m][0].element),s.addColumn("number",n[m][0].element+" in "+n[m][0].einheit),h++);s.addRows(i);var p=new google.visualization.Dashboard(u),b=new google.visualization.ControlWrapper({controlType:"ChartRangeFilter",containerId:d+"_slider_overlay",options:{filterColumnIndex:0,ui:{chartOptions:{height:50}}}}),D=new google.visualization.ChartWrapper({chartType:"LineChart",containerId:d+"_chart_overlay",options:{titleTextStyle:{fontSize:18},title:v.substring(0,v.length-2),hAxis:{title:"Datum"}}});p.bind(b,D),p.draw(s),chartsDataTables[d+"_chart_overlay"]=[],chartsDataTables[d+"_chart_overlay"]=n}function getOverlayDataArray(e){for(var t=[],a=[],r=0,n=0;n<e.length;n++){var o=e[n];if(-1==a.indexOf(o[0].element)){for(a.push(o[0].element),x=0;x<e[n].length;x++){var d=o[x].date;d=convertToDate(d);var i=o[x].wert;i=parseFloat(i.replace(",",".")),0==r?(t[x]=[],t[x][0]=d,t[x][1]=i):t[x][r+1]=i}r++}}return t}function uncheckButtons(e){var t=document.getElementById(e+"_button");null!=t&&(t.checked=!1)}function addDeleteChartButton(e){for(var t=document.getElementById(e),a=!1,r=0;r<t.childNodes.length;r++)"button"==t.childNodes[r].type&&(a=!0);if(!a){var n=document.createElement("button"),o=document.createTextNode("Lösche Diagramm");n.setAttribute("type","button"),n.setAttribute("class","btn btn-xs btn-primary deleteButton"),n.appendChild(o),t.appendChild(n),n.onclick=function(){var e=t.parentNode;e.removeChild(t)}}}function redrawOnResize(){console.log("redraw");var e=document.getElementById("charts").childNodes;if(e.length>0){console.log(e);for(var t=0;t<e.length;t++)"DIV"==e[t].nodeName&&drawDashboard(chartsDataTables[e[t].id.replace(/_dashboard/g,"_chart")][0])}}var chartsDataTables=[];